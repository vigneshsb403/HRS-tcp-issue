events {}

http {
    server {
        listen 80;
        server_name localhost;

        location / {
            # Log the body of the request to the access log
            log_format custom '$remote_addr - $remote_user [$time_local] "$request" '
                              'Body: "$request_body" $status $body_bytes_sent "$http_referer" '
                              '"$http_user_agent" "$http_x_forwarded_for"';
            access_log /var/log/nginx/access.log custom;

            # Read the request body
            set $request_body "";

            # Lua module to capture request body
            content_by_lua_block {
                ngx.req.read_body()
                local data = ngx.req.get_body_data()
                if data then
                    ngx.var.request_body = data
                end
            }

            # Response with the captured body
            echo_read_request_body;
            echo "Request Body: $request_body";
        }
    }
}

